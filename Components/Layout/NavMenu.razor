@using Stockly.Services
@inject UserStateService UserState
@inject NavigationManager Navigation
@inject DrawerService DrawerService

<MudNavMenu>
    <!-- Home - Available to all authenticated users -->
    <MudNavLink Href="" Match="NavLinkMatch.All" Icon="@Icons.Material.Outlined.Home">Home</MudNavLink>
    
    <!-- Admin View - Only for admin role -->
    @if (UserState.Role == "admin")
    {
        <MudNavLink Href="AdminView" Match="NavLinkMatch.All" Icon="@Icons.Material.Outlined.SupervisedUserCircle">Admin</MudNavLink>
    }
    
    <!-- Opening Inventory - Only for opening and admin roles -->
    @if (UserState.Role == "opening" || UserState.Role == "admin")
    {
        <MudNavLink Href="OpeningInventory" Match="NavLinkMatch.All" Icon="@Icons.Material.Outlined.LockOpen">Opening Shift</MudNavLink>
    }
    
    <!-- Closing Inventory - Only for closing and admin roles -->
    @if (UserState.Role == "closing" || UserState.Role == "admin")
    {
        <MudNavLink Href="ClosingInventory" Match="NavLinkMatch.All" Icon="@Icons.Material.Outlined.Lock">Closing Shift</MudNavLink>
    }
    
    <!-- Products - Available to all authenticated users -->
    <MudNavLink Href="Products" Match="NavLinkMatch.Prefix" Icon="@Icons.Material.Outlined.List">Products</MudNavLink>
    
    <div style="margin-top: auto;">
        @if (UserState.IsAuthenticated)
        {
            <MudNavLink OnClick="HandleLogout" Icon="@Icons.Material.Outlined.Logout">Logout</MudNavLink>
        }
        else
        {
            <MudNavLink Href="Login" Match="NavLinkMatch.Prefix" Icon="@Icons.Material.Outlined.Login">Login</MudNavLink>
        }
    </div>
</MudNavMenu>

<style>
    .mud-navmenu {
        display: flex;
        flex-direction: column;
        height: 100%;
    }
</style>

@code {
    protected override void OnInitialized()
    {
        UserState.OnChange += StateHasChanged;
    }

    public void Dispose()
    {
        UserState.OnChange -= StateHasChanged;
    }

    private void HandleLogout()
    {
        UserState.Logout();
        DrawerService.Close(); // Collapse drawer on logout
        Navigation.NavigateTo("/Login");
    }
}