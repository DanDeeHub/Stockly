@page "/Login"

<PageTitle>Login</PageTitle>

<div class="d-flex flex-column justify-center align-center" style="height: 80vh;">
    <div class="d-flex flex-column gap-3 pa-4" style="width: 300px;">
        <MudText Typo="Typo.h5" Class="text-center pb-4">Sign In</MudText>
        
        <MudForm @ref="Form" @bind-IsValid="IsValid" @bind-Errors="Errors">
            <div class="d-flex align-center">
                <MudTextField @bind-Value=LoginModel.Username Label="Username" Variant="Variant.Outlined" Required="true" RequiredError="Please enter your username" Class="flex-grow-1" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Person" />
            </div>
            
            <div class="d-flex align-center">
                <MudTextField @bind-Value="LoginModel.Password" Label="Password" Variant="Variant.Outlined" Required="true" RequiredError="Please enter your password" InputType="InputType.Password" Class="flex-grow-1" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Lock" />
            </div>
            
            <MudCheckBox T="bool" @bind-Checked="LoginModel.RememberMe" Label="Remember Me" Color="Color.Primary" />
            
            @if (!string.IsNullOrEmpty(ErrorMessage))
            {
                <MudAlert Severity="Severity.Error" Class="mt-2">@ErrorMessage</MudAlert>
            }
            
            <MudButton Variant="Variant.Filled" Color="Color.Primary" FullWidth="true" Class="mt-4" Size="Size.Medium" OnClick="HandleLogin" Disabled="IsLoading">
                @if (IsLoading)
                {
                    <MudProgressCircular Size="Size.Small" Indeterminate="true" />
                    <span class="ml-2">Signing In...</span>
                }
                else
                {
                    <span>Sign In</span>
                }
            </MudButton>
        </MudForm>
        
        <!-- Debug Info - Remove this in production -->
        @if (UserState.IsAuthenticated)
        {
            <MudAlert Severity="Severity.Info" Class="mt-2">
                <MudText Typo="Typo.body2">
                    <strong>Debug Info:</strong><br/>
                    User ID: @(UserState.CurrentUser?.Id.ToString("D"))<br/>
                    Username: @UserState.CurrentUser?.Username<br/>
                    Role: @UserState.CurrentUser?.Role
                </MudText>
            </MudAlert>
        }
    </div>
</div>